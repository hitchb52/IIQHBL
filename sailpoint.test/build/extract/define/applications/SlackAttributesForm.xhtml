<!DOCTYPE html PUBLIC
                "-//W3C//DTD XHTML 1.0 Transitional//EN"
                "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- (c) Copyright 2020 SailPoint Technologies, Inc., All Rights Reserved. -->

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:sp="http://sailpoint.com/ui">

<body>
  <ui:composition>
    <script type="text/javascript">
      <!--//--><![CDATA[//><!--
      helpKey = 'APPLICATION';

      function getFieldValue(fieldname) {
          var val = null;
          var field = Ext.getDom(fieldname);
          if ( field ) {
              val = field.value;
          }
          return val;
      }

      Ext.onReady(function () {
          Ext.QuickTips.init();
          var host = getFieldValue('editForm:host');
          if (host.length == 0) {
              Ext.getDom('editForm:host').value = 'https://api.slack.com/scim/v1';
          }

          var pageSize = getFieldValue('editForm:pageSize');
          if (pageSize.length == 0) {
              // Maximum page size supported by Slack is 1000, Set default pageSize to 200.
              Ext.getDom('editForm:pageSize').value = '200';
          }

          // This is our validation hook
          Page.on('beforeSave', function() {
              if (!hasCredentialConfiguration()) {
                  var host = getFieldValue('editForm:host');
                  Validator.validateNonBlankString(host, "#{msgs.con_form_slack_error_host_required}");

                  var apiToken = getFieldValue('editForm:apiToken');
                  Validator.validateNonBlankString(apiToken, "#{msgs.con_form_slack_error_token_required}");

                  var errors = Validator.getErrors();
                  if (errors && errors.length > 0) {
                      Validator.displayErrors('appErrorsTop');
                      return false;
                  }
              }
              return true;
          });
      });

      //--><!]]>
    </script>
    <f:view>
      <div id="slackConnectivitySettings" class='spContent'>
        <h:outputText styleClass="sectionHeader" value="#{msgs.con_form_connection_settings}" />
        <table class="spTable" style="border: 0px" cellspacing="0">
          <tr id="slackURLRow">
            <td class='titleColumn certScheduleTitleCol'>
              <h:outputText style='padding:5px' value="#{msgs.con_slack_api_host_name}" />
              <h:outputText styleClass="requiredText" value="*" /></td>
            <td class="certScheduleHelpCol">
              <h:graphicImage id="imgHlpUrl" styleClass="helpIcon" url="/images/icons/dashboard_help_16.png" 
                 alt="#{help.help_con_slack_host}" />
            </td>
            <td>
              <h:inputText id="host" value="#{applicationObject.attributes['host']}" size="40" redisplay="true"
                disabled="#{!sp:hasRight(facesContext, 'ManageApplication')}"
                readonly="#{!sp:hasRight(facesContext, 'ManageApplication')}" />
            </td>
          </tr>

          <tr id="slackAPIKeyRow">
            <td class='titleColumn certScheduleTitleCol'>
              <h:outputText style='padding:5px' value="#{msgs.con_slack_api_token}" />
              <h:outputText styleClass="requiredText" value="*" />
            </td>
            <td class="certScheduleHelpCol">
              <h:graphicImage id="imgHlpUser" styleClass="helpIcon" url="/images/icons/dashboard_help_16.png" 
                 alt="#{help.help_con_slack_api_token}" /></td>
            <td>
              <sp:inputSecret id="apiToken" value="#{applicationObject.attributes['apiToken']}" size="40"
                redisplay="true" disabled="#{!sp:hasRight(facesContext, 'ManageApplication')}"
                readonly="#{!sp:hasRight(facesContext, 'ManageApplication')}" autocomplete="off" />
            </td>
          </tr>

          <tr>
            <td class='titleColumn certScheduleTitleCol'>
              <h:outputText style='padding:5px' value="#{msgs.con_form_slack_page_size}" />
            </td>
            <td class="certScheduleHelpCol">
              <h:graphicImage id="imgHlpPageSize" styleClass="helpIcon"
                 url="/images/icons/dashboard_help_16.png" alt="#{help.help_con_slack_page_size}" />
            </td>
            <td>
              <h:inputText id="pageSize" value="#{applicationObject.attributes['pageSize']}" size="20"
                disabled="#{!sp:hasRight(facesContext, 'ManageApplication')}"
                readonly="#{!sp:hasRight(facesContext, 'ManageApplication')}">
               <f:validateLongRange minimum="1" maximum="1000" /> <!-- Slack supports minimum 1 and maximum 1000 page size. -->
              </h:inputText>
            </td>
          </tr>
        </table>
      </div>

      <div id="slackAggrgationFilterSettings" class='spContent'>
       <h:outputText styleClass="sectionHeader" value="#{msgs.con_form_slack_agg_filter_label}" />
       <table class="spTable" style="border: 0px" cellspacing="0">
          <tr id="accountFilterRow">
            <td class='titleColumn certScheduleTitleCol'>
              <h:outputText style='padding:5px' value="#{msgs.con_form_slack_account_agg_filter}" />
            </td>
            <td class="certScheduleHelpCol">
              <h:graphicImage id="imgHlpAccountFilter" styleClass="helpIcon" url="/images/icons/dashboard_help_16.png" 
               alt="#{help.help_con_slack_account_agg_constraint}" />
            </td>
            <td>
              <h:inputText id="accountFilterString"
                value="#{applicationObject.attributes['accountFilterString']}"
                disabled="#{!sp:hasRight(facesContext, 'ManageApplication')}"
                readonly="#{!sp:hasRight(facesContext, 'ManageApplication')}" />
            </td>
          </tr>
           <tr id="groupFilterRow">
            <td class='titleColumn certScheduleTitleCol'>
              <h:outputText style='padding:5px' value="#{msgs.con_form_slack_group_agg_filter}" />
            </td>
            <td class="certScheduleHelpCol">
              <h:graphicImage id="imgHlpGroupFilter" styleClass="helpIcon" url="/images/icons/dashboard_help_16.png" 
               alt="#{help.help_con_slack_group_agg_constraint}" />
            </td>
            <td>
              <h:inputText id="groupFilterString"
                value="#{applicationObject.attributes['groupFilterString']}"
                disabled="#{!sp:hasRight(facesContext, 'ManageApplication')}"
                readonly="#{!sp:hasRight(facesContext, 'ManageApplication')}" />
            </td>
          </tr>
          <tr>
            <td class='titleColumn certScheduleTitleCol' valign="center">
               <h:outputText style='padding:0px' value=""/>
            </td>
          </tr>
          <tr>
            <td class='titleColumn certScheduleTitleCol' valign="center">
              <h:outputText style='padding:5px' value="#{msgs.con_form_manage_channels}"/>
            </td>
            <td class="certScheduleHelpCol" valign="middle">
              <h:graphicImage id="imgHlpManageChannels" styleClass="helpIcon" url="/images/icons/dashboard_help_16.png" 
                              alt="#{msgs.help_con_form_manage_channels}"/>
            </td>
            <td valign="center">
              <h:selectBooleanCheckbox 
                id="isManageChannels"
                style="padding-top:15px"
                value="#{applicationObject.attributes['manageChannels']}"
                requiredMessage="#{msgs.help_con_form_manage_channels}"
                disabled="#{!sp:hasRight(facesContext, 'ManageApplication')}" />
            </td>
            </tr>
          </table>
       </div>
    </f:view>
  </ui:composition>
</body>
</html>